============================= test session starts =============================
platform win32 -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: E:\HEXAWARE_FASTAPI\DAY2\commerce_app
plugins: anyio-4.12.1, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/test_category.py::test_create_category FAILED                      [ 12%]
tests/test_category.py::test_list_categories PASSED                      [ 25%]
tests/test_customer.py::test_create_customer FAILED                      [ 37%]
tests/test_migration.py::test_alembic_upgrade FAILED                     [ 50%]
tests/test_migration.py::test_alembic_downgrade FAILED                   [ 62%]
tests/test_order.py::test_create_order PASSED                            [ 75%]
tests/test_product.py::test_create_product PASSED                        [ 87%]
tests/test_product.py::test_product_validation FAILED                    [100%]

================================== FAILURES ===================================
____________________________ test_create_category _____________________________

client = <starlette.testclient.TestClient object at 0x00000185F98E3B60>

    def test_create_category(client):
        response = client.post("/categories", json={"name": "Electronics"})
>       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests\test_category.py:3: AssertionError
---------------------------- Captured stdout call -----------------------------
Exception occured: (sqlite3.IntegrityError) UNIQUE constraint failed: categories.name
[SQL: INSERT INTO categories (name) VALUES (?)]
[parameters: ('Electronics',)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stderr call -----------------------------
Traceback (most recent call last):
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: UNIQUE constraint failed: categories.name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\middleware\exception.py", line 9, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\cors.py", line 87, in __call__
    await self.app(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 431, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 315, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\anyio\to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\controllers\category_controller.py", line 14, in create_category
    return service.create_category(category_data.dict())
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\services\category_service.py", line 13, in create_category
    return self.category_repository.create_category(category_data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\repository\category_repository.py", line 11, in create_category
    self.db.commit()
    ~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 121, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: categories.name
[SQL: INSERT INTO categories (name) VALUES (?)]
[parameters: ('Electronics',)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
____________________________ test_create_customer _____________________________

client = <starlette.testclient.TestClient object at 0x00000185F9D44CD0>

    def test_create_customer(client):
        response = client.post("/customers/", json={
            "name": "John Doe",
            "email": "john.doe@example.com"
            })
>       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests\test_customer.py:6: AssertionError
---------------------------- Captured stdout call -----------------------------
Exception occured: (sqlite3.IntegrityError) UNIQUE constraint failed: customers.email
[SQL: INSERT INTO customers (name, email) VALUES (?, ?)]
[parameters: ('John Doe', 'john.doe@example.com')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stderr call -----------------------------
Traceback (most recent call last):
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: UNIQUE constraint failed: customers.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\middleware\exception.py", line 9, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\cors.py", line 87, in __call__
    await self.app(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 431, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\fastapi\routing.py", line 315, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\starlette\concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\anyio\to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\controllers\customer_controller.py", line 14, in create_customer
    return service.create_customer(customer_data.dict())
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\services\customer_service.py", line 13, in create_customer
    return self.customer_repository.create_customer(customer_data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\repository\customer_repository.py", line 11, in create_customer
    self.db.commit()
    ~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 121, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: customers.email
[SQL: INSERT INTO customers (name, email) VALUES (?, ?)]
[parameters: ('John Doe', 'john.doe@example.com')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
____________________________ test_alembic_upgrade _____________________________

    def test_alembic_upgrade():
        config = get_alembic_config()
>       command.upgrade(config, "head")

tests\test_migration.py:15: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\venv\Lib\site-packages\alembic\command.py:463: in upgrade
    script = ScriptDirectory.from_config(config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\venv\Lib\site-packages\alembic\script\base.py:186: in from_config
    return ScriptDirectory(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <alembic.script.base.ScriptDirectory object at 0x00000185F9D61160>
dir = WindowsPath('E:/HEXAWARE_FASTAPI/DAY2/commerce_app/alembic')
file_template = '%(rev)s_%(slug)s', truncate_slug_length = None
version_locations = None, sourceless = False, output_encoding = 'utf-8'
timezone = None, hooks = [], recursive_version_locations = False
messaging_opts = immutabledict({'quiet': False})

    def __init__(
        self,
        dir: Union[str, os.PathLike[str]],  # noqa: A002
        file_template: str = _default_file_template,
        truncate_slug_length: Optional[int] = 40,
        version_locations: Optional[
            Sequence[Union[str, os.PathLike[str]]]
        ] = None,
        sourceless: bool = False,
        output_encoding: str = "utf-8",
        timezone: Optional[str] = None,
        hooks: list[PostWriteHookConfig] = [],
        recursive_version_locations: bool = False,
        messaging_opts: MessagingOptions = cast(
            "MessagingOptions", util.EMPTY_DICT
        ),
    ) -> None:
        self.dir = _preserving_path_as_str(dir)
        self.version_locations = [
            _preserving_path_as_str(p) for p in version_locations or ()
        ]
        self.file_template = file_template
        self.truncate_slug_length = truncate_slug_length or 40
        self.sourceless = sourceless
        self.output_encoding = output_encoding
        self.revision_map = revision.RevisionMap(self._load_revisions)
        self.timezone = timezone
        self.hooks = hooks
        self.recursive_version_locations = recursive_version_locations
        self.messaging_opts = messaging_opts
    
        if not os.access(dir, os.F_OK):
>           raise util.CommandError(
                f"Path doesn't exist: {dir}.  Please use "
                "the 'init' command to create a new "
                "scripts folder."
            )
E           alembic.util.exc.CommandError: Path doesn't exist: E:\HEXAWARE_FASTAPI\DAY2\commerce_app\alembic.  Please use the 'init' command to create a new scripts folder.

app\venv\Lib\site-packages\alembic\script\base.py:105: CommandError
___________________________ test_alembic_downgrade ____________________________

    def test_alembic_downgrade():
        config = get_alembic_config()
>       command.downgrade(config, "base")

tests\test_migration.py:19: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\venv\Lib\site-packages\alembic\command.py:507: in downgrade
    script = ScriptDirectory.from_config(config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\venv\Lib\site-packages\alembic\script\base.py:186: in from_config
    return ScriptDirectory(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <alembic.script.base.ScriptDirectory object at 0x00000185F9D78E10>
dir = WindowsPath('E:/HEXAWARE_FASTAPI/DAY2/commerce_app/alembic')
file_template = '%(rev)s_%(slug)s', truncate_slug_length = None
version_locations = None, sourceless = False, output_encoding = 'utf-8'
timezone = None, hooks = [], recursive_version_locations = False
messaging_opts = immutabledict({'quiet': False})

    def __init__(
        self,
        dir: Union[str, os.PathLike[str]],  # noqa: A002
        file_template: str = _default_file_template,
        truncate_slug_length: Optional[int] = 40,
        version_locations: Optional[
            Sequence[Union[str, os.PathLike[str]]]
        ] = None,
        sourceless: bool = False,
        output_encoding: str = "utf-8",
        timezone: Optional[str] = None,
        hooks: list[PostWriteHookConfig] = [],
        recursive_version_locations: bool = False,
        messaging_opts: MessagingOptions = cast(
            "MessagingOptions", util.EMPTY_DICT
        ),
    ) -> None:
        self.dir = _preserving_path_as_str(dir)
        self.version_locations = [
            _preserving_path_as_str(p) for p in version_locations or ()
        ]
        self.file_template = file_template
        self.truncate_slug_length = truncate_slug_length or 40
        self.sourceless = sourceless
        self.output_encoding = output_encoding
        self.revision_map = revision.RevisionMap(self._load_revisions)
        self.timezone = timezone
        self.hooks = hooks
        self.recursive_version_locations = recursive_version_locations
        self.messaging_opts = messaging_opts
    
        if not os.access(dir, os.F_OK):
>           raise util.CommandError(
                f"Path doesn't exist: {dir}.  Please use "
                "the 'init' command to create a new "
                "scripts folder."
            )
E           alembic.util.exc.CommandError: Path doesn't exist: E:\HEXAWARE_FASTAPI\DAY2\commerce_app\alembic.  Please use the 'init' command to create a new scripts folder.

app\venv\Lib\site-packages\alembic\script\base.py:105: CommandError
___________________________ test_product_validation ___________________________

client = <starlette.testclient.TestClient object at 0x00000185F9D48830>

    def test_product_validation(client):
        response = client.post("/products/", json={
            "name": "Invalid Product",
            "description": "This product has invalid price and stock",
            "price": -10,
            "stock": 5,
            "category_id": 1
            })
        assert response.status_code == 422
        data = response.json()
>       assert data["detail"] == "Input should be greater than zero"
E       AssertionError: assert [{'ctx': {'gt': 0.0}, 'input': -10, 'loc': ['body', 'price'], 'msg': 'Input should be greater than 0', ...}] == 'Input should be greater than zero'

tests\test_product.py:26: AssertionError
============================== warnings summary ===============================
app\schemas\product_schema.py:23
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\schemas\product_schema.py:23: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ProductResponse(ProductBase):

app\schemas\category_schema.py:10
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\schemas\category_schema.py:10: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class CategoryResponse(CategoryBase):

app\schemas\customer_schema.py:11
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\schemas\customer_schema.py:11: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class CustomerResponse(CustomerBase):

app\schemas\order_schema.py:10
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\schemas\order_schema.py:10: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class OrderResponse(OrderBase):

tests/test_category.py::test_create_category
tests/test_order.py::test_create_order
tests/test_product.py::test_create_product
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\controllers\category_controller.py:14: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    return service.create_category(category_data.dict())

tests/test_customer.py::test_create_customer
tests/test_order.py::test_create_order
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\controllers\customer_controller.py:14: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    return service.create_customer(customer_data.dict())

tests/test_order.py::test_create_order
tests/test_product.py::test_create_product
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\controllers\product_controller.py:15: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    return service.create_product(product_data.dict())

tests/test_order.py::test_create_order
  E:\HEXAWARE_FASTAPI\DAY2\commerce_app\app\controllers\order_controller.py:14: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    return service.create_order(order_data.dict())

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_category.py::test_create_category - assert 500 == 200
FAILED tests/test_customer.py::test_create_customer - assert 500 == 200
FAILED tests/test_migration.py::test_alembic_upgrade - alembic.util.exc.Comma...
FAILED tests/test_migration.py::test_alembic_downgrade - alembic.util.exc.Com...
FAILED tests/test_product.py::test_product_validation - AssertionError: asser...
================== 5 failed, 3 passed, 12 warnings in 0.32s ===================
